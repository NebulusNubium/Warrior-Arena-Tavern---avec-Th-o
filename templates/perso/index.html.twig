{% extends 'base.html.twig' %}

{% block title %}Les personnages{% endblock %}

{% block body %}
    <h1>Ajouter un personnage</h1>
    {% for message in app.flashes('success') %}
        <div class="alert alert-success">{{ message }}</div>
    {% endfor %}


    {# Cropper.js CSS #}
    <link rel="stylesheet" href="https://unpkg.com/cropperjs/dist/cropper.min.css" />

    {{ form_start(characterForm, {'attr': {'enctype': 'multipart/form-data'}}) }}
        {{ form_row(characterForm.name) }}
        {{ form_row(characterForm.HP) }}
        {{ form_row(characterForm.power) }}
        {{ form_row(characterForm.defense) }}
        {{ form_row(characterForm.description) }}
        {{ form_row(characterForm.imageFile) }}
        {{ form_row(characterForm.roleName) }}
        {{ form_row(characterForm.typeName) }}
        <button type="submit" class="btn btn-primary">Ajouter</button>
    {{ form_end(characterForm) }}


    <h2>Liste des personnages</h2>
    <div class="character-list">
        {% for character in characters %}
            <div class="character-item" style="display: flex; align-items: center; gap: 1em;">
                {% if character.imageName %}
                    <img src="{{ asset('uploads/images/' ~ character.imageName) }}" alt="{{ character.name }}" style="width:60px; height:60px; object-fit:cover; border-radius:50%;">
                {% else %}
                    <div style="width:60px; height:60px; border-radius:50%; background:#eee; display:flex; align-items:center; justify-content:center; color:#aaa; font-size:2em;">?</div>
                {% endif %}
                <div>
                    <h3>{{ character.name }}</h3>
                    <p><strong>PV:</strong> {{ character.HP }} | <strong>Puissance:</strong> {{ character.power }} | <strong>Défense:</strong> {{ character.defense }}</p>
                    <p>{{ character.description }}</p>
                    {% set roles = character.role|default([]) %}
                    {% if roles|length > 0 %}
                        <p><strong>Rôle :</strong>
                            {% for role in roles %}
                                <span class="badge bg-secondary">{{ role.name }}</span>{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                    {% endif %}
                    {% set types = character.type|default([]) %}
                    {% if types|length > 0 %}
                        <p><strong>Type :</strong>
                            {% for type in types %}
                                <span class="badge bg-info">{{ type.name }}</span>{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <p>Aucun personnage trouvé.</p>
        {% endfor %}
    </div>
{% endblock %}
